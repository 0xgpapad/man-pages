.\" Copyright (C) 2016-2017, Microsemi Corporation
.\" Copyright (C) 2016, PMC-Sierra, Inc.
.\" Written by Kevin Barnett <kevin.barnett@microsemi.com>
.\"
.\" %%%LICENSE_START(GPLv2_ONELINE)
.\" Licensed under GNU General Public License version 2 (GPLv2)
.\" %%%LICENSE_END
.\"
.\" shorthand for double quote that works everywhere.
.ds q \N'34'
.TH SMARTPQI 4 "smartpqi"
.SH NAME
smartpqi \- Microsemi Smart Family SCSI driver
.SH SYNOPSIS
.nf
modprobe smartpqi [ disable_device_id_wildcards=1 ] [ disable_heartbeat=1 ] [ disable_ctrl_shutdown=1 ] [ lockup_action=none | reboot | panic ]
.fi
.SH DESCRIPTION
.B smartpqi
is a SCSI driver for Microsemi Smart Family controllers.
.SH OPTIONS
.PP
disable_device_id_wildcards=1
.RS 4
This option disables support for device ID wildcards.
The default value is 0.
.RE
.PP
disable_heartbeat=1
.RS 4
This option disables support for the controller's heartbeat check. This parameter is used for debug purposes.
The default value is 0, do not disable the heartbeat check.
.RE
.PP
disable_ctrl_shutdown=1
.RS 4
This option disables support for shutting down the controller in the event of a controller lockup.
The default value is 0.
.RE
.PP
lockup_action=none | reboot | panic
.RS 4
This option specifies the action the driver takes when a controller lockup is detected.
The default action is none.
.PP
.RE
.RS 4
.nf
parameter          action
---------          ----------------------------
.br
none               take controller offline only
.br
reboot             reboot the system
.br
panic              panic the system
.fi
.RE
.SH CONFIGURATION DETAILS
To configure Microsemi Smart Family controllers, please refer to the controller's User Guide documentation.
.RE
.SH FILES
.SS DEVICE NODES
Logical drives are accessed via the SCSI disk driver (sd),
tape drives via the SCSI tape driver (st), and
the RAID controller via the SCSI generic driver (sg), with
device nodes named /dev/sd*, /dev/st*, and /dev/sg*, respectively.
.SS SMARTPQI SPECIFIC HOST ATTRIBUTE FILES IN /sys

.PP
.I /sys/class/scsi_host/host*/rescan
.RS 4
The host "rescan" attribute is a write-only attribute.  Writing to
this attribute will cause the driver to scan for new, changed, or
removed devices (e.g. hot-plugged tape drives, or newly configured
or deleted logical drives, etc.) and notify the SCSI mid-layer of
any changes detected.  Normally this is triggered automatically by
configuration changes, so the user should not normally have to use
this. It may be useful when hot plugging devices like tape drives,
or entire storage boxes containing pre-configured logical drives.
.RE
.PP
.I /sys/class/scsi_host/host*/version
.RS 4
The host "version" attribute is a read-only attribute. This attribute
contains the driver version and the controller firmware version.
.nf
.PP
For example:
.RS 4

cat /sys/class/scsi_host/host1/version
driver: 1.1.2-126
firmware: 1.29-112
.RE
.fi
.RE
.PP
.I /sys/class/scsi_host/host*/lockup_action
.RS 4
The host "lockup_action" attribute is a read-write attribute. This attribute
will cause the driver to perform a specific action in the unlikely event that
a controller lockup has been detected. See
.B OPTIONS
section for an explanation
of the lockup_action values.
.RE

.SS SMARTPQI SPECIFIC DISK ATTRIBUTE FILES IN /sys
.PP
.I /sys/class/scsi_disk/c:b:t:l/device/raid_level
.RS 4
The "raid_level" attribute is read-only.
This attribute contains the RAID level of each logical drive.
.P
.nf
For example:
.RS 4
cat /sys/class/scsi_disk/4:0:0:0/device/raid_level
RAID 0
.RE
.fi
.RE
.PP
.I /sys/class/scsi_disk/c:b:t:l/device/sas_address
.RS 4
The "sas_address" attribute is read-only.
This attribute contains the unique identifier of the disk.
.P
.nf
For example:
.RS 4
cat /sys/class/scsi_disk/1:0:3:0/device/sas_address
0x5001173d028543a2
.RE
.fi
.RE
.PP
.I /sys/class/scsi_disk/c:b:t:l/device/ssd_smart_path_enabled
.RS 4
The "ssd_smart_path_enabled" attribute is read-only.
This attribute is for ioaccel enabled volumes.
Contains 1 if ioaccel is enabled for the volume, 0 otherwise.
.P
.nf
For example:
.RS 4
cat /sys/class/scsi_disk/1:0:3:0/device/ssd_smart_path_enabled
0
.RE
.fi
.RE
.SH SUPPORTED IOCTLS
For compatibility with applications written for the hpsa driver, many, but
not all of the ioctls supported by the hpsa driver are also supported by the
smartpqi driver.  The data structures used by these are described in
include/linux/cciss_ioctl.h
.PP
CCISS_DEREGDISK,
CCISS_REGNEWDISK,
and CCISS_REGNEWD
.RS 4
The above three ioctls all do exactly the same thing, which is to cause the driver
to rescan for new devices.  This does exactly the same thing as writing to the
smartpqi specific host "rescan" attribute.
.RE
.PP
CCISS_GETPCIINFO
.RS 4
Returns PCI domain, bus, device and function and "board ID" (PCI subsystem ID).
.RE
.PP
CCISS_GETDRIVVER
.RS 4
Returns driver version in four bytes encoded as:
(major_version << 28) | (minor_version << 24) | (release << 16) | revision
.RE
.PP
CCISS_PASSTHRU
.RS 4
Allows "BMIC" and "CISS" commands to be passed through to the controller.
.RE
.SH "SEE ALSO"
hpsa(4), sd(4), st(4), and from the linux kernel source tree:
.br
Documentation/ABI/testing/sysfs-bus-pci-devices-cciss

.SH AUTHORS
smartpqi was written by Kevin Barnett <kevin.barnett@microsemi.com>
.br
.nf
This man page was written by Kevin Barnett <kevin.barnett@microsemi.com> and
.br
Don Brace <don.brace@microsemi.com>
.fi
