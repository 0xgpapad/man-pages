.\" Copyright (C) 1993 David Metcalfe (david@prism.demon.co.uk)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one.
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" References consulted:
.\"     Linux libc source code
.\"     Lewine's _POSIX Programmer's Guide_ (O'Reilly & Associates, 1991)
.\"     386BSD man pages
.\" Modified Sat Jul 24 16:09:49 1993 by Rik Faith (faith@cs.unc.edu)
.\" Modified 11 June 1995 by Andries Brouwer (aeb@cwi.nl)
.\" Modified 22 July 1996 by Andries Brouwer (aeb@cwi.nl)
.\" 2007-07-30 Ulrich Drepper <drepper@redhat.com>, mtk:
.\"     Rework discussion of non-standard structure fields.
.\" 2008-07-04, mtk, Document readdir_r().
.\"
.TH READDIR 3  2008-07-04 "" "Linux Programmer's Manual"
.SH NAME
readdir, readdir_r \- read a directory
.SH SYNOPSIS
.nf
.B #include <dirent.h>
.sp
.BI "struct dirent *readdir(DIR *" dir );
.sp
.BI "int readdir_r(DIR *" dir ", struct dirent *" entry \
", struct dirent **" result );
.fi
.SH DESCRIPTION
The
.BR readdir ()
function returns a pointer to a \fIdirent\fP structure
representing the next directory entry in the directory stream pointed
to by \fIdir\fP.
It returns NULL on reaching the end of the directory stream or if
an error occurred.
.PP
On Linux, the
.I dirent
structure is defined as follows:
.PP
.in +4n
.nf
struct dirent {
    ino_t          d_ino;       /* inode number */
    off_t          d_off;       /* offset to the next dirent */
    unsigned short d_reclen;    /* length of this record */
    unsigned char  d_type;      /* type of file */
    char           d_name[256]; /* filename */
};
.fi
.in
.PP
According to POSIX, the
.I dirent
structure contains a field
.I "char d_name[]"
of unspecified size, with at most
.B NAME_MAX
characters preceding the terminating null byte.
POSIX.1-2001 also documents the field
.I "ino_t d_ino"
as an XSI extension.
The other fields are unstandardized, and not present on all systems;
see NOTES below for some further details.
.PP
The data returned by
.BR readdir ()
may be overwritten by subsequent calls to
.BR readdir ()
for the same directory stream.

The
.BR readdir_r ()
function is a reentrant version of
.BR readdir ().
It reads the next directory entry from the directory stream
.IR dir ,
and returns it in the caller-allocated buffer pointed to by
.IR entry .
(See NOTES for information on allocating this buffer.)
A pointer to the returned item is placed in
.IR *result ;
if the end of the directory stream was encountered,
then NULL is instead returned in
.IR *result .
.SH "RETURN VALUE"
The
.BR readdir ()
function returns a pointer to a
.I dirent
structure, or
NULL if an error occurs or end of the directory stream is reached.
On error,
.I errno
is set appropriately.

The
.BR readdir_r ()
function returns 0 on success.
On error, it returns a positive error number.
If the end of the directory stream is reached,
.BR readdir_r ()
returns 0, and returns NULL in
.IR *result .
.SH ERRORS
.TP
.B EBADF
Invalid directory stream descriptor \fIdir\fP.
.SH "CONFORMING TO"
SVr4, 4.3BSD, POSIX.1-2001.
.SH NOTES
Only the fields
.I d_name
and
.I d_ino
are specified in POSIX.1-2001.
The remaining fields are available on many, but not all systems.
Under glibc,
programs can check for the availability of the fields not defined
in POSIX.1 by testing whether the macros
.BR _DIRENT_HAVE_D_NAMLEN ,
.BR _DIRENT_HAVE_D_RECLEN ,
.BR _DIRENT_HAVE_D_OFF ,
or
.B _DIRENT_HAVE_D_TYPE
are defined.

Other than Linux, the
.I d_type
field is available mainly only on BSD systems.
This field makes it possible to avoid the expense of calling
.BR stat (2)
if further
actions depend on the type of the file.
If the
.B _BSD_SOURCE
feature test macro is defined,
then glibc defines the following macro constants
for the value returned in
.IR d_type :
.TP 12
.B DT_BLK
This is a block device.
.TP
.B DT_CHR
This is a character device.
.TP
.B DT_DIR
This is a directory.
.TP
.B DT_FIFO
This is a named pipe (FIFO).
.TP
.B DT_LNK
This is a symbolic link.
.TP
.B DT_REG
This is a regular file.
.TP
.B DT_SOCK
This is a Unix domain socket.
.TP
.B DT_UNKNOWN
The file type is unknown.
.\" The glibc manual says that on some systems this is the only
.\" value returned
.PP
If the file type could not be determined, the value
.B DT_UNKNOWN
is returned in
.IR d_type .

Since POSIX.1 does not specify the size of the
.I d_name
field, and other non-standard fields may precede that field within the
.I dirent
structure, portable applications that use
.BR readdir_r ()
should allocate the buffer whose address is passed in
.IR entry
as follows:
.in +4n
.nf

len = offsetof(struct dirent, d_name) +
          pathconf(dirpath, _PC_NAME_MAX) + 1
entryp = malloc(len);

.fi
.in
(POSIX.1 requires that
.I d_name
is the last field in a
.IR "struct dirent" .)
.SH "SEE ALSO"
.BR read (2),
.BR closedir (3),
.BR dirfd (3),
.BR ftw (3),
.BR offsetof (3),
.BR opendir (3),
.BR rewinddir (3),
.BR scandir (3),
.BR seekdir (3),
.BR telldir (3),
.BR feature_test_macros (7)
